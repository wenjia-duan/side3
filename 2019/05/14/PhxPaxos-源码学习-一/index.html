<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Paxos从理论到实践(一) - Gavin@Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言这一系列文章是笔者学习和实现paxos协议的心得和体会。初步计划包含如下几个部分：  理解paxos协议 phxpaxos源码学习 实现自己的paxos版本  此为第一篇：初识paxos 初识paxos什么是paxos paxos是一种共识算法(consensus algorithm), 由Leslie Lamport在1990年提出。  共识即对某个提议(proposal)达成一致。为了达成">
<meta name="keywords" content="paxos,phxpaxos">
<meta property="og:type" content="article">
<meta property="og:title" content="Paxos从理论到实践(一)">
<meta property="og:url" content="https://wenjia-duan.github.io/side3/2019/05/14/PhxPaxos-源码学习-一/index.html">
<meta property="og:site_name" content="Gavin@Hexo">
<meta property="og:description" content="前言这一系列文章是笔者学习和实现paxos协议的心得和体会。初步计划包含如下几个部分：  理解paxos协议 phxpaxos源码学习 实现自己的paxos版本  此为第一篇：初识paxos 初识paxos什么是paxos paxos是一种共识算法(consensus algorithm), 由Leslie Lamport在1990年提出。  共识即对某个提议(proposal)达成一致。为了达成">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-08-20T13:25:57.398Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Paxos从理论到实践(一)">
<meta name="twitter:description" content="前言这一系列文章是笔者学习和实现paxos协议的心得和体会。初步计划包含如下几个部分：  理解paxos协议 phxpaxos源码学习 实现自己的paxos版本  此为第一篇：初识paxos 初识paxos什么是paxos paxos是一种共识算法(consensus algorithm), 由Leslie Lamport在1990年提出。  共识即对某个提议(proposal)达成一致。为了达成">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/side3/side3/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/side3/side3/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/side3/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/side3/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/side3/">Home</a>
        
          <a class="main-nav-link" href="/side3/archives">Archives</a>
        
          <a class="main-nav-link" href="/side3/categories">Categories</a>
        
          <a class="main-nav-link" href="/side3/wechat">Wechat</a>
        
          <a class="main-nav-link" href="/side3/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://wenjia-duan.github.io/side3"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="post-PhxPaxos-源码学习-一" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Paxos从理论到实践(一)
      <small class="article-detail-date-index">&nbsp; 2019-05-14</small>
    </h1>
  


        <div class="page-title"></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/side3/2019/05/14/PhxPaxos-源码学习-一/" class="article-date">
  <time datetime="2019-05-13T16:11:27.000Z" itemprop="datePublished">2019-05-14</time>
</a>-->
      <!-- 
--><!-- by blair 160724 -->
      <!-- by blair
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这一系列文章是笔者学习和实现paxos协议的心得和体会。<br>初步计划包含如下几个部分：</p>
<ul>
<li>理解paxos协议</li>
<li>phxpaxos源码学习</li>
<li>实现自己的paxos版本</li>
</ul>
<p>此为第一篇：初识paxos</p>
<h1 id="初识paxos"><a href="#初识paxos" class="headerlink" title="初识paxos"></a>初识paxos</h1><h2 id="什么是paxos"><a href="#什么是paxos" class="headerlink" title="什么是paxos"></a>什么是paxos</h2><blockquote>
<p>paxos是一种共识算法(consensus algorithm), 由Leslie Lamport在1990年提出。</p>
</blockquote>
<p>共识即对某个提议(proposal)达成一致。为了达成共识，需要满足如下条件：</p>
<ul>
<li>只有一个提议的值可以被选中(chosen)</li>
<li>只会选中一个值</li>
<li>系统不会感知到一个值被选中除非大家达成了共识</li>
</ul>
<p>即：共识确定的是一个值，且该值只有一个(常量).</p>
<h2 id="为什么需要共识-paxos"><a href="#为什么需要共识-paxos" class="headerlink" title="为什么需要共识(paxos)?"></a>为什么需要共识(paxos)?</h2><p>paxos解决的是分布式系统的一致性问题。</p>
<p>试想在分布式系统中的N个节点,任意一个节点随时都可能宕机，节点彼此间只能通过“消息”来传递信息，但是此消息在传输过程中可能：</p>
<ul>
<li>丢失：消息没有到达对方</li>
<li>乱序：消息到达的顺序与发送的顺序不一致</li>
<li>但是不会被篡改</li>
</ul>
<p>如何才能保证在上述条件下，分布式系统中的N个节点可以保持一致呢？这就是paxos算法要解决的问题。</p>
<blockquote>
<p>或许你会说：这不是很简单吗，只要让分布式系统的所有节点都受到消息不就达成共识吗？</p>
</blockquote>
<p>可是，在上面描述的条件下，只要有一个节点无法通信，系统就无法达成共识。</p>
<blockquote>
<p>或许你还会说：那就不要用分布式系统了，只有一个节点就好了，节点间也不需要通信</p>
</blockquote>
<p>可是，如果只有一个节点，系统的可用性是非常糟糕的。</p>
<blockquote>
<p>或许你还会说：按照分布式系统的CAP理论，系统的一致性，可用性和分区容忍性是无法同时保证的。</p>
</blockquote>
<p>嗯，paxos并没有推翻CAP理论，他只是在保证了一致性的前提下，最大化了系统的可用性(多数派)</p>
<blockquote>
<p>追问：那quorum(NRW)协议也可以保证一致性呀<br>emmm..</p>
</blockquote>
<h2 id="Paxos算法描述-基本上是翻译paxos-simple这篇论文）"><a href="#Paxos算法描述-基本上是翻译paxos-simple这篇论文）" class="headerlink" title="Paxos算法描述(基本上是翻译paxos simple这篇论文）"></a>Paxos算法描述(基本上是翻译paxos simple这篇论文）</h2><p>为了选中一个值，我们假设系统中存在一个提议者(proposer) 以及若干个接收者(acceptor)和若干个学习者(learner),只要足够多的接收者（大多数, &gt;N/2)确认(accept)了提议者提议的值，我们就认为这个值被选中(chosen)。因为任意两个多数派必定有共同的接收者，因此被选中的值是唯一的。<br>另外，我们假定每个提议都有一个自增的编号，且不同的提议者提出的提议的编号不会重叠(这有很多种实现方法，比如分号段）<br>同时算法提出如下要求：</p>
<p>P1: 接收者(acceptor)必须接受他接收到的第一个提议(proposal)</p>
<blockquote>
<p>An acceptor must accept the first proposal that it receives</p>
</blockquote>
<p>P2: 如果一个值为v的提议(编号为n)被选中，那所有编号比n大且被选中的提议的值也是v</p>
<blockquote>
<p>If a proposal with value v is chosen, then every higher-numbered proposal that is chosen has value v</p>
</blockquote>
<p>P2a:如果一个值为v的提议(编号为n)被选中，那被接收者确认的所有编号比n大的提议的值为v</p>
<blockquote>
<p>If a proposal with value v is chosen, then every higher-numbered proposal accepted by any acceptor has value v</p>
</blockquote>
<p>P2b:如果一个值为v的提议(编号为n)被选中，那由提议者提议的所有编号比n大的提议的值为v</p>
<blockquote>
<p>If a proposal with value v is chosen, then every higher-numbered proposal issued by any proposal has value v</p>
</blockquote>
<p>P2c:</p>
<blockquote>
<p>For any value v and n, if a proposal with value v and number n is issued, there is a set S consisting of a majority of<br>acceptors such that either (a) no acceptor in S has accepted any proposal numbered less than n, or (b) v is the value of the highest-numbered proprosal among all proposals numbered less than n accepted by acceptos in S.</p>
</blockquote>
<p>由p2 -&gt; p2a -&gt; p2b 其实是很自然的，但是p2c就会比较晦涩些。</p>
<hr>
<p>根据上述算法的描述， 我们可以把算法的执行过程分为三部分：</p>
<h3 id="1-提议者-proposal"><a href="#1-提议者-proposal" class="headerlink" title="1. 提议者(proposal)"></a>1. 提议者(proposal)</h3><p>P1: 提议者提出一个提议P，序号为n，其值为v</p>
<p>P1a: 如果接收者接受了这个提议 $P_n$，则接受者承诺不会确认序号比n小的提议，同时，如果接受者已经确认(accept)了一个提议，则将已确认的提议中序号最大的提议的值一并返回</p>
<p>P2: 如果提议者确认多数派接受者已经接受了此提议，如果接收者未返回提议的值，则该提议Pn的值v被选中(chosen)，如果接收者返回了已确认的值，按照P2b的要求，则接受者返回的值被选中(chosen)</p>
<p>P2b: 按照P2中选中的值，向所有接收者发送确认消息(accept)<br>P2c: 如果接收者返回确认消息不可被确认，则该提议被终止，回到P1，重新发起提议。</p>
<h3 id="2-接受者-acceptor"><a href="#2-接受者-acceptor" class="headerlink" title="2. 接受者(acceptor)"></a>2. 接受者(acceptor)</h3><p>A1: 接受者收到提议者发出的提议，需要为n，其值为v</p>
<p>A1a: 如果接收者第一次接受到提议，则将该提议的序号n序列化存储，并告知提议者者已接受</p>
<p>A1b: 如果接收者已经接受到了其他提议，则承诺不会确认(accept)序号小于n的提议。如果接收者已经确认了(accept)某个提议，则将已确认的提议中的序号最大的提议的值返回给提议者</p>
<p>A2: 接受者收到提议者发出的确认(accept)消息</p>
<p>A2a: 如果确认消息的序号小于接受者存储的承诺的序号，则告知提议者该消息不可确认。</p>
<p>A2b: 如果确认消息的序号等于接收者存储的序号，则告知提议者该消息已确认。</p>
<h3 id="3-学习者-learner"><a href="#3-学习者-learner" class="headerlink" title="3. 学习者(learner)"></a>3. 学习者(learner)</h3><p>按下不表</p>
<h2 id="各种异常情况下的paxos算法推演"><a href="#各种异常情况下的paxos算法推演" class="headerlink" title="各种异常情况下的paxos算法推演"></a>各种异常情况下的paxos算法推演</h2>
      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<div id="bottom-donation-section">
<span style="font-size: 1.0em; padding:0em 1em 0.5em 1em; margin: 0 auto;">
  <strong style="vertical-align: top;">分享到:</strong>
    <div class="j_handlclick" style="background: url(/images/tech-logos/share_facebook_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank">
    </div>
    <div class="j_handlclick" style="background: url(/images/tech-logos/share_weibo_icon.png);background-size: contain;display: inline-block; width:50px; height:50px" href="https://service.weibo.com/share/share.php?url" target="_blank">
    </div>
    <div class="j_handlclick" style="background: url(/images/tech-logos/share_wechat_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=" target="_blank">
    </div>
    <div class="j_handlclick" style="background: url(/images/tech-logos/share_twitter_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://twitter.com/intent/tweet?url=" target="_blank">
    </div>
  <br>  
  <br>  
  &nbsp;&nbsp;如果您觉得这篇文章对您的学习很有帮助, 请您也分享它, 让它能再次帮助到更多的需要学习的人.
您的<a href="/support/"><strong>支持</strong></a>将鼓励我继续创作 !
  <br>  

</span>
<!--
<h3 id="bottom-donation-title">支持 让文章变得更优质</h3>
<div>
<a id="bottom-donation-button" href="/support">点我 赞助 作者</a>
</div>
-->
</div>
<div class="well">
  <!--
  原创文章，转载请注明： 转载自<a href="http://52binge.github.io"> Blair Chan's Blog</a>，作者：
  <a href="/about">Blair Chan</a> <br>
  -->
  本文基于<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">署名4.0国际许可协议</a>发布，转载请保留本文署名和文章链接。 如您有任何授权方面的协商，请邮件联系我。
</div>
 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>Contents</h3>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#初识paxos"><span class="toc-number"></span> <span class="toc-text">初识paxos</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是paxos"><span class="toc-number">1.</span> <span class="toc-text">什么是paxos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么需要共识-paxos"><span class="toc-number">2.</span> <span class="toc-text">为什么需要共识(paxos)?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Paxos算法描述-基本上是翻译paxos-simple这篇论文）"><span class="toc-number">3.</span> <span class="toc-text">Paxos算法描述(基本上是翻译paxos simple这篇论文）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-提议者-proposal"><span class="toc-number">3.1.</span> <span class="toc-text">1. 提议者(proposal)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-接受者-acceptor"><span class="toc-number">3.2.</span> <span class="toc-text">2. 接受者(acceptor)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-学习者-learner"><span class="toc-number">3.3.</span> <span class="toc-text">3. 学习者(learner)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#各种异常情况下的paxos算法推演"><span class="toc-number">4.</span> <span class="toc-text">各种异常情况下的paxos算法推演</span></a></li></ol>
      </li></div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        
  <div class="article-tag">
    <a class="article-tag-link" href="/side3/tags/paxos/">paxos</a><span></span><a class="article-tag-link" href="/side3/tags/phxpaxos/">phxpaxos</a>
  </div>


      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/side3/2019/08/16/ARTS-0x00-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          ARTS-0x00
        
      </div>
    </a>
  
  
    <a href="/side3/2019/04/30/认识正确的自己/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">认识正确的自己&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 wenjia duan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    

<script src="/side3/side3/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/side3/fancybox/jquery.fancybox.css">
  <script src="/side3/fancybox/jquery.fancybox.pack.js"></script>


<script src="/side3/js/script.js"></script>

  </div>
</body>
</html>
